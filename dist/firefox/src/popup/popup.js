import{b as i}from"../../browser-polyfill.js";function r(t){const e=Math.floor(t/1e3),n=Math.floor(e/60),o=Math.floor(n/60);return o>0?`${o}h ${n%60}m`:n>0?`${n}m ${e%60}s`:`${e}s`}const x=document.getElementById("status-indicator"),C=document.getElementById("status-text"),b=document.getElementById("login-view"),k=document.getElementById("login-form"),T=document.getElementById("email"),h=document.getElementById("password"),g=document.getElementById("login-error"),a=document.getElementById("login-btn"),M=document.getElementById("main-view"),I=document.getElementById("current-domain"),v=document.getElementById("current-time"),D=document.getElementById("session-start"),H=document.getElementById("active-time"),O=document.getElementById("background-time"),w=document.getElementById("domain-list"),f=document.getElementById("toggle-btn"),B=document.getElementById("toggle-icon"),S=document.getElementById("toggle-text"),G=document.getElementById("options-btn"),N=document.getElementById("user-email"),P=document.getElementById("logout-btn");let c=null,l=!1;async function A(){try{return await i.runtime.sendMessage({type:"GET_AUTH_STATE"})}catch(t){return console.error("Failed to get auth state:",t),null}}async function p(){try{return await i.runtime.sendMessage({type:"GET_STATS"})}catch(t){return console.error("Failed to fetch stats:",t),null}}function d(){b.classList.remove("hidden"),M.classList.add("hidden"),x.className="status-indicator unauthenticated",C.textContent="Not signed in"}function y(t){b.classList.add("hidden"),M.classList.remove("hidden"),N.textContent=t.userEmail||""}function E(t){x.className="status-indicator "+t.status;const e={tracking:"Tracking",paused:"Paused",idle:"Idle",unauthenticated:"Not signed in"};C.textContent=e[t.status]||t.status,t.currentSession.activeTab?(I.textContent=t.currentSession.activeTab.domain,v.textContent=r(t.currentSession.currentSiteTime)):(I.textContent="-",v.textContent="-");const n=new Date(t.currentSession.sessionStartTime);D.textContent=n.toLocaleTimeString(),H.textContent=r(t.todayStats.totalActiveTime),O.textContent=r(t.todayStats.totalBackgroundTime),U(t.todayStats.domainStats),t.status==="paused"?(f.classList.add("paused"),B.textContent="▶",S.textContent="Resume"):(f.classList.remove("paused"),B.textContent="⏸",S.textContent="Pause")}function U(t){const e=Object.values(t);if(e.length===0){w.innerHTML='<li class="empty-state">No activity recorded yet</li>';return}const n=e.sort((o,s)=>s.activeTime+s.backgroundTime-(o.activeTime+o.backgroundTime)).slice(0,5);w.innerHTML=n.map(function(o){const s=o.activeTime+o.backgroundTime;return`
        <li>
          <span class="domain-name">${$(o.domain)}</span>
          <span class="domain-time">${r(s)}</span>
        </li>
      `}).join("")}function $(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}async function _(t){if(t.preventDefault(),l)return;const e=T.value.trim(),n=h.value;if(!e||!n){m("Please enter both email and password");return}l=!0,a.disabled=!0,a.innerHTML='<span class="spinner"></span> Signing in...',F();try{const o=await i.runtime.sendMessage({type:"LOGIN",payload:{email:e,password:n}});if(o.success){T.value="",h.value="";const s=await A();s!=null&&s.isAuthenticated&&(y(s),L())}else m(o.error||"Login failed")}catch(o){console.error("Login error:",o),m("An error occurred. Please try again.")}finally{l=!1,a.disabled=!1,a.textContent="Sign In"}}function m(t){g.textContent=t,g.classList.remove("hidden")}function F(){g.classList.add("hidden")}async function V(){try{await i.runtime.sendMessage({type:"LOGOUT"}),u(),d()}catch(t){console.error("Logout error:",t)}}async function j(){try{await i.runtime.sendMessage({type:"TOGGLE_PAUSE"});const t=await p();t&&E(t)}catch(t){console.error("Failed to toggle pause:",t)}}function z(){i.runtime.openOptionsPage()}function L(){p().then(function(t){t&&E(t)}),c=setInterval(async function(){const t=await p();t&&(t.status==="unauthenticated"?(u(),d()):E(t))},1e3)}function u(){c&&(clearInterval(c),c=null)}async function R(){const t=await A();t!=null&&t.isAuthenticated?(y(t),L()):d(),k.addEventListener("submit",_),P.addEventListener("click",V),f.addEventListener("click",j),G.addEventListener("click",z),i.runtime.onMessage.addListener(function(e){if(e.type==="AUTH_STATE_CHANGED"){const n=e.payload;n.isAuthenticated?(y(n),L()):(u(),d())}})}window.addEventListener("unload",function(){u()});document.addEventListener("DOMContentLoaded",R);
