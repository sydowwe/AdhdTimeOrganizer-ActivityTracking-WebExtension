import{b as u}from"../../browser-polyfill.js";const i=document.getElementById("blocklist-input"),b=document.getElementById("add-blocklist"),o=document.getElementById("blocklist"),s=document.getElementById("fullurl-input"),E=document.getElementById("add-fullurl"),r=document.getElementById("fullurl-list"),c=document.getElementById("save-status");let n={blocklist:[],trackFullUrlDomains:[]};async function L(){try{const t=await u.storage.sync.get("settings");t.settings&&(n=t.settings),F()}catch(t){console.error("Failed to load settings:",t),l("Failed to load settings",!0)}}async function a(){try{await u.storage.sync.set({settings:n}),await u.runtime.sendMessage({type:"UPDATE_SETTINGS",payload:n}),l("Settings saved")}catch(t){console.error("Failed to save settings:",t),l("Failed to save settings",!0)}}function l(t,e=!1){c.textContent=t,c.className="save-status"+(e?" error":""),setTimeout(()=>{c.textContent=""},3e3)}function v(t){let e=t.trim().toLowerCase();return e=e.replace(/^https?:\/\//,""),e=e.split("/")[0],e=e.split(":")[0],e=e.replace(/^www\./,""),e}function y(t){return t?/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,}$/.test(t):!1}function F(){d(),m()}function d(){if(n.blocklist.length===0){o.innerHTML='<li class="empty-state">No blocked domains</li>';return}o.innerHTML=n.blocklist.map(t=>p(t,"blocklist")).join(""),o.querySelectorAll(".btn-danger").forEach(t=>{t.addEventListener("click",function(){const e=this.dataset.domain;e&&D(e)})})}function m(){if(n.trackFullUrlDomains.length===0){r.innerHTML='<li class="empty-state">No domains configured</li>';return}r.innerHTML=n.trackFullUrlDomains.map(t=>p(t,"fullurl")).join(""),r.querySelectorAll(".btn-danger").forEach(t=>{t.addEventListener("click",function(){const e=this.dataset.domain;e&&B(e)})})}function p(t,e){return`
    <li>
      <span class="domain-name">${f(t)}</span>
      <button class="btn btn-danger" data-domain="${f(t)}" data-list="${e}">
        Remove
      </button>
    </li>
  `}function f(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function k(t){const e=v(t);if(!y(e)){l("Please enter a valid domain",!0);return}if(n.blocklist.includes(e)){l("Domain already in blocklist",!0);return}n.blocklist.push(e),a(),d(),i.value=""}function D(t){n.blocklist=n.blocklist.filter(e=>e!==t),a(),d()}function g(t){const e=v(t);if(!y(e)){l("Please enter a valid domain",!0);return}if(n.trackFullUrlDomains.includes(e)){l("Domain already in list",!0);return}n.trackFullUrlDomains.push(e),a(),m(),s.value=""}function B(t){n.trackFullUrlDomains=n.trackFullUrlDomains.filter(e=>e!==t),a(),m()}function h(){b.addEventListener("click",()=>{k(i.value)}),i.addEventListener("keypress",t=>{t.key==="Enter"&&k(i.value)}),E.addEventListener("click",()=>{g(s.value)}),s.addEventListener("keypress",t=>{t.key==="Enter"&&g(s.value)})}document.addEventListener("DOMContentLoaded",()=>{L(),h()});
